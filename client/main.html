<head>
  <title>No 209</title>
  <link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.43.0/css/font-awesome.min.css' rel='stylesheet' />
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
</head>
<body>

</body>

<template name="main">
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="{{pathFor route='home'}}"><img src="/images/logo_50px.png" style="height:100%;" /></a>
        </div>

        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            {{#if currentUser}}
            <li><a href="{{pathFor route='mylistings'}}">My Listings</a></li>
            <li><a href="{{pathFor route='mymessages'}}">Messages</a></li>
            <li><a href="{{pathFor route='favorites'}}">Favorites</a></li>
            {{/if}}
            <li><a href="{{pathFor route='about'}}">About</a></li>
          </ul>
          
          <ul class="nav navbar-nav navbar-right">
            <li>{{> loginButtons align="right"}}</li>
          </ul>
        </div>
      </div>
    </nav>


    {{> yield}}

</template>

<template name="mylistings">
    <div class="col-md-12 left-side">
    {{#unless isVerified}}<div class="alert alert-warning" role="alert">Your email is not yet verified so you cannot create a listing or contact anyone on the site.  <a href="#" id="sendverifyemail">Verify your email</a> now to start in the fun!</div>{{/unless}}
    <h2>Your Listings&nbsp;&nbsp;{{#if isVerified}}<a href="/new" style="font-size:65%;"><i class="fa fa-plus"></i> Add Listing</a>{{/if}}</h2>
    {{#unless results.count}}0 listings{{/unless}}
    <ul>
    {{#each results}}
    <li><a href="{{pathFor route='listing' _id=_id }}">{{title}}</a>&nbsp;&nbsp;<a href="{{pathFor route='update' _id=_id }}"><i class="fa fa-pencil"></i></a>&nbsp;&nbsp;<a href="#" id="delete"><i class="fa fa-trash-o"></i></a>
    
    {{#unless approved}}
    &nbsp;&nbsp;
    <i class="fa fa-exclamation-circle"></i> Approval Pending
    {{else}}
      {{#unless stripeCustomerId}}
      &nbsp;&nbsp;
      <button type="button" class="btn btn-warning btn-xs" id="pay">
        <span class="glyphicon glyphicon-usd" aria-hidden="true"></span> Activate
      </button>
      {{/unless}}
    {{/unless}}

    </li>
    {{/each}}
    </ul>
    </div>
</template>

<template name="mymessages">
    <div class="col-md-6 left-side">

      <h2>Your Inbox</h2>
      {{#unless receivedmessages.count}}0 messages{{/unless}}
      <div class="panel-group" id="accordion1" role="tablist" aria-multiselectable="true">
        {{#each receivedmessages}}
        <div class="panel panel-default">
          <div class="panel-heading" role="tab" id="heading{{_id}}">
            <h4 class="panel-title">
              <a role="button" data-toggle="collapse" data-parent="#accordion1" href="#collapse{{_id}}" aria-expanded="false" aria-controls="collapse{{_id}}" class="accordion-toggle collapsed">
              <i class="fa fa-plus"></i>
              <i class="fa fa-minus"></i>
              <strong>From: {{contactor.profile.firstname}} {{contactor.profile.lastname}}</strong>
              &nbsp;&nbsp;<em>{{trimit comment}}</em>
              </a>
              <span class="date">{{formatDate createdAt}}</span>
            </h4>
          </div>
          <div id="collapse{{_id}}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading{{_id}}">
            <div class="panel-body">
            <p>{{breaklines comment}}</p>

            <a href="{{pathFor route='listing' _id=listingId }}">listing</a>
            </div>
          </div>
        </div>
        {{/each}}
      </div>

    </div>
    
    <div class="col-md-6 left-side">

      <h2>Your Sent Messages</h2>
      {{#unless sentmessages.count}}0 messages{{/unless}}
      <div class="panel-group" id="accordion2" role="tablist" aria-multiselectable="true">
        {{#each sentmessages}}
        <div class="panel panel-default">
          <div class="panel-heading" role="tab" id="heading{{_id}}">
            <h4 class="panel-title">
              <a role="button" data-toggle="collapse" data-parent="#accordion2" href="#collapse{{_id}}" aria-expanded="true" aria-controls="collapse{{_id}}" class="accordion-toggle collapsed">
              <i class="fa fa-plus"></i>
              <i class="fa fa-minus"></i>
              <strong>To: {{contactTo.profile.firstname}} {{contactTo.profile.lastname}}</strong>
              &nbsp;&nbsp;<em>{{trimit comment}}</em>
              </a>
              <span class="date">{{formatDate createdAt}}</span>
            </h4>
          </div>
          <div id="collapse{{_id}}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading{{_id}}">
            <div class="panel-body">
            <p>{{breaklines comment}}</p>
            <a href="{{pathFor route='listing' _id=listingId }}">listing</a>
            </div>
          </div>
        </div>
        {{/each}}
      </div>

    </div>
    <br /><br /><br /><br /><br />
</template>

<template name="listing">
{{#if showToNonOwner userId approved}}
    <div class="col-md-8 left-side" id="listing">

      {{#unless approved}}
        <div class="alert alert-warning" role="alert">This listing has not been approved yet. Please give us some time to look it over and flip the switch. You will get an email when the listing is approved and at that point you can enter your payment details.</div>
      {{else}}
        {{#if isOwner userId}}
          {{#unless stripeCustomerId}}
          <div class="alert alert-warning" role="alert">Once this listing is ready to go you'll want to activate it. We don't start charging you until you do so that you can get it absolutely perfect before you release it to the world. Ready? <a href="#" id="pay">Activate now</a> to start in on the fun!</div>
          {{/unless}}
        {{/if}}
      {{/unless}}
      
      
      
      <h1>{{#if verified}}<a href="{{pathFor route='about'}}"><img src="/images/verified_badge_lg.png" title="209 Verified Listing"></a>{{/if}}  {{title}}</h1>
      {{#if currentUser}}
        <span class="rating"><a href="#" id="faveme" class="star {{#if favorited}}starred{{/if}}"></a>Favorite</span>
      {{/if}}
      <span class="contact-link">
      {{#unless isOwner userId}}
        {{#if currentUser}}
        <a href="#" id="comment">Contact <i class="fa fa-envelope"></i></a>
        {{else}}
        Sign in / join to send a message
        {{/if}}
      {{else}}
        <a href="{{pathFor route='update' _id=_id }}">Edit listing <i class="fa fa-pencil"></i></a> |
        <a href="#" id="uploadimages">Manage Photos <i class="fa fa-picture-o"></i></a>
      {{/unless}}
      </span>

      <div class="popup-gallery">
      <section class="block" style="clear:both;">
          <div id="myCarousel" class="carousel slide">
              <div class="carousel-inner">

                  <div class="active item">
                  <a href="{{photourl.url}}" title="Main Image">
                      <img src="{{photourl.url}}" class="img-responsive" style="width:100%;"/>
                  </a>
                  </div>
              </div>
          </div>
      </section>
      <br /><br />
      {{#each photos}}
       <a href="{{photosurl.url store='extras'}}" title="{{title}}">
          <img src="{{photosurl.url store='thumbs'}}" title="{{title}}">
       </a>
       {{/each}}
    </div>
      <p></p>
      <p></p>
    </div>

    <div class="col-md-4 right-side listing">
      <div class="spacey"></div>
      {{#if isOwner userId}}
        <h3>Inbox</h3>
        {{#unless contacts.count}}No messages yet{{/unless}}
        <ul>
        {{#each contacts}}
        <li>{{formatDate createdAt}} <strong>{{contactor.profile.firstname}} {{contactor.profile.lastname}}</strong> - {{trimit comment}} <a href="#" id="contactreply"><i class="fa fa-reply"></i></a></li>
        {{/each}}
        </ul>
        
        {{#if contacted.count}}<h3>My Sent Messages</h3>{{/if}}
        <ul>
        {{#each contacted}}
        <li>{{formatDate createdAt}} <strong>{{contactTo.profile.firstname}} {{contactTo.profile.lastname}}</strong> - {{trimit comment}}</li>
        {{/each}}
        </ul>

      {{else}}
        {{#if currentUser}}
            {{#if contacted.count}}<h3>My Sent Messages</h3>{{/if}}
            <ul>
            {{#each contacted}}
            <li>{{formatDate createdAt}} - {{trimit comment}}</li>
            {{/each}}
            </ul>


            {{#if responses.count}}<h3>Replies from Owner</h3>{{/if}}
            <ul>
            {{#each responses}}
            <li>{{formatDate createdAt}} - {{trimit comment}} <a href="#" id="contactreply"><i class="fa fa-reply"></i></a></li>
            {{/each}}
            </ul>
          {{/if}}
      {{/if}}

    <div class="details">
    <h3>Details</h3>
    <strong>Type:</strong> {{listingType}}<br />
    <strong>Price:</strong> ${{price}}/month<br />
    <strong>Power:</strong> {{#if hasPower}}Yes{{else}}No{{/if}}<br />
    <strong>Water:</strong> {{#if hasWater}}Yes{{else}}No{{/if}}<br />
    <strong>SQ Feet:</strong> {{sqFeet}}<br />
    <strong>Max Height:</strong> {{maxHeight}}<br /><br />
    <div class="description"><p>{{breaklines description}}</p></div>

    </div>
  

  </div>
{{else}}
<div class="col-md-12 left-side" id="listing">
<div class="alert alert-warning" role="alert">Uh oh, this listing hasn't received our stamp of approval yet. Is it yours? Log in and you'll be able to view and edit while we're doing our job to approve.</div>
</div>
{{/if}} 
</template>

<template name="home">

    <div class="col-md-7 col-sm-6 left-side" id="listings">

      <div id="filters" class="collapse in">
        <div class="row filters">
          <div class="col-md-6 col-xs-12">
            <select name="listingType" class="form-control" id="listingtype">
              <option value="spot house">Show All</option>
              <option value="spot">Tiny Parking Spots Only</option>
              <option value="house">Tiny Houses Only</option>
            </select>
          </div>
          <div class="col-md-6 col-xs-12 verified">
             <label for="verified"><input type="checkbox" name="verified" id="verified" value="1"> 209 Verified Listings Only&nbsp;&nbsp;<a href="{{pathFor route='about'}}"><img src="/images/verified_badge.png" title="209 Verified Badge: Click to learn more" height="23px"></a></label>
          </div>

        </div>
        <div class="row filters">
          <div class="col-xs-12">
            <div id="slider-low"></div><div id="slider"></div><div id="slider-high"></div>
          </div>
        </div>
      </div>
      <div class="row filtertoggle">
        <div class="col-xs-12" style="text-align:center;">
          <a href="#" data-toggle="collapse" data-target="#filters" id="filtertoggle"><i class="fa fa-filter"></i> show/hide filters</a>
        </div>
      </div>
      
      
      <div class="hidden-xs">
        {{#unless results.count}}
          <h4>We couldnâ€™t find any results that matched your criteria, but tweaking your search may help. Here are some ideas:</h4>
          <ul>
          <li>Remove some filters.</li>
          <li>Expand the area of your search.</li>
          <li>Search for a city, address, or landmark.</li>
          </ul>
        {{/unless}}
        {{#each results}}
          <div class="col-md-6">
          <div class="listing">
            <a href="{{pathFor route='listing' _id=_id }}">
              {{#if verified}}<div class="overlay-verified"><img src="/images/verified_badge.png" title="209 Verified Listing"></div>{{/if}}
              <div class="overlay-price">$ {{price}}/mo</div>
              <img src="{{photourl.url store='tiles'}}" class="img-responsive" style="width:100%;"/>
              <div class="details"><h3 class="listing-title">{{title}}</h3></div>
            </a>
             {{#unless isOwner userId}}
              {{#if currentUser}}
              <div class="contact-link"><a href="#" id="comment">Contact <i class="fa fa-envelope"></i></a></div>
              {{/if}}
            {{/unless}}

          </div>
        </div>
        {{/each}}
      </div>
    </div>

    <div class="col-md-5 col-sm-6 right-side home">
     <div id="overlay">
       <form class="locate-search">
        <input type="text" name="text" placeholder="Find location" style="width:75%;" />
       </form>
     </div>

    {{> map}}
    </div>
</template>

<template name="map">
      <div id="map" class="map"></div>
</template>

<template name="new">
  <div class="spacey"></div>
   
  <div class="col-md-6">
    <h1>Create Listing</h1>
   {{#autoForm id="insertForm" type="insert" collection="Listings"}}
    {{> afQuickField name="listingType"}}
    {{> afQuickField name="title"}}
    {{> afQuickField name="address"}}
    {{> afQuickField name="price"}}
    {{> afQuickField name="hasPower"}}
    {{> afQuickField name="hasWater"}}
    {{> afQuickField name="sqFeet"}}
    {{> afQuickField name="maxHeight"}}
    {{> afQuickField name="description" rows=6}}
    {{> afQuickField name="verifyRequested"}}
    {{> afQuickField name="photo"}}
    {{> afQuickField name="coordinates" class="coordinates"}}
    <button class="btn btn-default" type="submit">Submit</button>
    {{/autoForm}}
    <br /><br />
  </div>

</template>


<template name="update">
  <div class="spacey"></div>
  <div class="col-md-6">
    <h1>Update Listing</h1>
    <div class="upload-images" style="float:right;"><a href="#" id="uploadimages"><i class="fa fa-picture-o"></i> Manage additional images</a> | <a href="{{pathFor route='listing' _id=_id }}"> View Listing</a></div>
    <br />
    {{#autoForm id="updateForm" doc=this type="update" collection="Listings"}}
    {{> afQuickField name="listingType"}}
    {{> afQuickField name="title"}}
    {{> afQuickField name="address"}}
    {{> afQuickField name="price"}}
    {{> afQuickField name="hasPower"}}
    {{> afQuickField name="hasWater"}}
    {{> afQuickField name="sqFeet"}}
    {{> afQuickField name="maxHeight"}}
    {{> afQuickField name="description" rows=6}}
    {{> afQuickField name="verifyRequested"}}
    {{> afQuickField name="photo"}}
    {{> afQuickField name="coordinates" class="coordinates"}}
    {{#if isInRole 'admin'}}
      {{> afQuickField name="verified"}}
      {{> afQuickField name="approved"}}
    {{/if}}
    
    <button class="btn btn-default" type="submit">Submit</button>
    {{/autoForm}}
    <br /><br />
  </div>
  
</template>

<template name="clear">
  <div class="spacey"></div>
  <div class="col-md-6">
    <h1>Clear Collections</h1>
    All collection items have been deleted.
    {{clear}}
  </div>

</template>

<template name="favorites">
  <div class="spacey"></div>
  <div class="col-md-6">
    <h1>My Favorites</h1>
    {{#unless results.count}}0 listings{{/unless}}
    <ul>
    {{#each results}}
    <li><a href="{{pathFor route='listing' _id=listing._id }}">{{listing.title}}</a></li>
    {{/each}}
    </ul>
  </div>

</template>

<template name="about">
  <div class="always-spacey"></div>
  <div class="col-md-7">
    <h1>About</h1>
    <h3>Welcome to no 209, the tiny house movement's marketplace</h3>
    <p>We believe that there are a lot of tiny spaces to fill with tiny homes and encourage home and landowners to list their available space for tiny house parking. Have a tiny already that needs a great occupant? Post that too!</p>
    <p><strong>Looking for a place to park your tiny or a tiny already parked and ready to move into?</strong> Browse around and when you're ready to learn more about a spot just hit the contact button and send the owner a note. See what unfolds from there.</p>
    <p><strong>Have a place to park a tiny?</strong> Create an account and post a listing. Then let the tiny owners find you.</p>
    <h3>Pricing</h3>
    <div class="col-md-4">
      <h4><strong>Tiny Listing<br />$8/month</strong></h4>
       <ul>
            <li>Unlimited messaging</li>
            <li>Up to 10 photos</li>
            <li>Don't pay until it's perfect</li>
            <li>Cancel anytime</li>
      </ul>
    </div>
    <div class="col-md-4">
      <h4><strong>209 Verified Listing<br />$8/month + $100 one time</strong></h4>
       <ul> 
            <li>All of the Tiny Listing features, plus...</li>
            <li>Site visit and assessment</li>
            <li>Professional quality photos</li>
            <li>Promoted on site</li>
      </ul>
    </div>

  </div>
  <div class="col-md-5">
    <div class="spacey"></div>
    <p><img src="/images/verified_badge_lg.png" title="209 Verified Listing" align="left" style="padding-right: 10px; padding-bottom: 500px; padding-top: 10px;"><h3>209 Verified</h3> Look for these listings that have been personally reviewed by us on location. We have measured the site, sized up the overall space to ensure that the listing is accurate and taken some great photos to show it off best. This hands on expert assessment gives you piece of mind when shopping for a tiny home or home for your tiny.
    <br /><br />
    Want your listing to be 209 Verified?  <a href="mailto:matt@clineranch.net">Contact us</a> for more info or just check the box when you create your listing and we'll contact you.
    </p> 
  </div>
</template>


<template name="commentModal">
    <div class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-header">
                 <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h3 class="modal-title">Contact</h3>
                </div>

                <div class="modal-body">
                    {{#unless isVerified}}<div class="alert alert-warning" role="alert">Your email is not yet verified so you cannot contact anyone on the site.  <a href="#" id="sendverifyemail">Verify your email</a> now to start in the fun!</div>{{/unless}}
                    {{#if isVerified}}
                    {{#autoForm id="insertComment" type="insert" collection="Contacts"}}
                    {{> afQuickField name="comment" rows=6}}
                    {{> afQuickField name="listingId" value=listingid}}
                     
                    <button class="btn btn-default" type="submit">Submit</button>
                    {{/autoForm}}
                    {{/if}}

                </div>


            </div>
        </div>
    </div>
</template>

<template name="fileUploader">
    <div class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-header">
                 <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h3 class="modal-title">Additional Images</h3>
                </div>

                <div class="modal-body">
                    <h3>Upload New</h3>
                    {{#if maxImages}}
                        Oops, you're at the max. Only 10 additional images can be uploaded.
                    {{else}}
                      {{#autoForm id="insertGallery" type="insert" collection="Photos"}}
                      {{> afQuickField name="title"}}
                      {{> afQuickField name="photo"}}
                      {{> afQuickField name="listingId" value=listingid}}
                       
                      <button class="btn btn-default" type="submit">Submit</button>
                      {{/autoForm}}
                    {{/if}}

                    <h3>Manage Existing</h3>
                    {{#unless photos.count}}No photos, upload some above.{{/unless}}
                    <ul class="photos">
                    {{#each photos}}
                    <li><img src="{{photosurl.url store='thumbs'}}" width="75px"> {{title}}</li>
                    {{/each}}
                    </ul>
                </div>


            </div>
        </div>
    </div>
</template>

<template name="contactReply">
    <div class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-header">
                 <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h3 class="modal-title">Reply</h3>
                </div>


                <div class="modal-body">
                  {{#unless isVerified}}<div class="alert alert-warning" role="alert">Your email is not yet verified so you cannot contact anyone on the site.  <a href="#" id="sendverifyemail">Verify your email</a> now to start in the fun!</div>{{/unless}}
                  
                  {{#if isVerified}}
                  <h3>Reply to: {{contacts.profile.firstname}} {{contacts.profile.lastname}}</h3>
                  <br />
      

                    {{#autoForm id="insertComment" type="insert" collection="Contacts"}}
                    {{> afQuickField name="comment" rows=6}}
                    {{> afQuickField name="listingId" value=listingid}}
                    {{> afQuickField name="userIdTo" value=contacts._id}}
                     
                    <button class="btn btn-default" type="submit">Submit</button>
                    {{/autoForm}}
                  {{/if}}

                </div>


            </div>
        </div>
    </div>
</template>

<template name="deleteConfirm">
    <div class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-header">
                 <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h3 class="modal-title">Delete Listing</h3>
                </div>
                <div class="modal-body">
      
                Deleting a listing is permenant and cannot be undone.  Are you sure that you would like to delete this listing and all of its related content? This will also delete the payment plan associated with this listing.

                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                  <a class="btn btn-danger btn-ok" id="deleteit">Delete</a>
                </div>


            </div>
        </div>
    </div>
</template>

<template name="creditCardDetails">
  <div class="col-xs-12">
  <div class="spacey"></div>
    <h3>Billing Information</h3>

    <div class="form-group">
      <label class="text-success"><i class="fa fa-lock"></i> Card Number</label>
        <input type="text" data-stripe="cardNumber" class="form-control card-number" placeholder="Card Number" value="4222222222222222">
    </div>
  </div>

  <div class="col-xs-4">
    <label>Exp. Mo.</label>
    <input type="text" data-stripe="expMo" class="form-control exp-month" placeholder="Exp. Mo.">
  </div>
  <div class="col-xs-4">
    <label>Exp. Yr.</label>
    <input type="text" data-stripe="expYr" class="form-control exp-year" placeholder="Exp. Yr.">
  </div>

  <div class="col-xs-4">
    <label>CVC</label>
    <input type="text" data-stripe="cvc" class="form-control cvc" placeholder="CVC">
  </div>
</template>


<template name="admin">
    <div class="col-md-6 left-side">
    <h2>Listings&nbsp;&nbsp;<a href="/new" style="font-size:65%;"><i class="fa fa-plus"></i> Add Listing</a></h2>
    <ul>
    {{#each results}}
    <li><a href="{{pathFor route='listing' _id=_id }}">{{title}}</a> {{#if approved}}<i class="fa fa-check"></i>{{/if}} ({{userId._id}})&nbsp;&nbsp;<a href="{{pathFor route='update' _id=_id }}"><i class="fa fa-pencil"></i></a>&nbsp;&nbsp;<a href="#" id="delete"><i class="fa fa-trash-o"></i></a>
    
    {{#unless stripeCustomerId}}
    &nbsp;&nbsp;
    <button type="button" class="btn btn-warning btn-xs" id="pay">
      <span class="glyphicon glyphicon-usd" aria-hidden="true"></span> Activate
    </button>
    {{/unless}}

    </li>
    {{/each}}
    </ul>
    </div>
    <div class="col-md-3 left-side">
    <h2>Contacts</h2>
    <ul>
    {{#each contacts}}
    <li>{{comment}}&nbsp;&nbsp;<a href="#" id="deleteUser"><i class="fa fa-trash-o"></i></a></li>
    {{/each}}
    </ul>
    </div>
    <div class="col-md-3 left-side">
    <h2>Users</h2>
    <ul>
    {{#each users}}
    <li>{{profile.lastname}}, {{profile.firstname}} ({{_id}})&nbsp;&nbsp;<a href="#" id="deleteUser"><i class="fa fa-trash-o"></i></a></li>
    {{/each}}
    </ul>
    </div>

</template>